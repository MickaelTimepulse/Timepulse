# üß™ Guide de Test Local - Timepulse

## üéØ Objectif
Tester Timepulse en local avant d√©ploiement production pour valider toutes les fonctionnalit√©s.

---

## ‚ö° OPTION 1: Test Express (15 minutes)

### Pr√©requis
- Node.js 18+ install√©
- Git install√©
- Un √©diteur de code (VS Code recommand√©)

### √âtapes

#### 1. T√©l√©charger le Projet
```bash
# Depuis Bolt.new, cliquer sur "Download Project"
# Ou cloner depuis votre repo Git
cd ~/Downloads
unzip timepulse.zip
cd timepulse
```

#### 2. Installer les D√©pendances
```bash
npm install
```
‚è±Ô∏è Dur√©e: ~2 minutes

#### 3. Configurer les Variables d'Environnement
```bash
cp .env.example .env
```

√âditer `.env` avec vos cl√©s Supabase:
```env
VITE_SUPABASE_URL=https://votre-projet.supabase.co
VITE_SUPABASE_ANON_KEY=votre_cle_anon

# Optionnel pour tests complets
VITE_STRIPE_PUBLIC_KEY=pk_test_...
VITE_FFA_API_KEY=votre_cle_ffa
VITE_FFTRI_API_KEY=votre_cle_fftri
```

**Note**: Sans les cl√©s API (FFA, FFTri, Oxisms), les services fonctionnent en **mode mock** automatiquement.

#### 4. Appliquer les Migrations Database

**Via Supabase Dashboard**:
1. Aller sur https://supabase.com/dashboard
2. S√©lectionner votre projet
3. Menu "SQL Editor"
4. Copier/coller CHAQUE fichier de `supabase/migrations/` dans l'ordre
5. Ex√©cuter chaque migration

**Migrations √† appliquer dans l'ordre**:
```
20251014201249_create_timepulse_schema.sql
20251014205617_create_admin_users_fixed.sql
20251014205715_add_update_password_function.sql
20251014210000_create_organizer_module.sql
... (tous les fichiers dans l'ordre chronologique)
20251023152000_add_sms_integration.sql
```

‚è±Ô∏è Dur√©e: ~10 minutes

#### 5. Lancer le Serveur de Dev
```bash
npm run dev
```

Votre app sera accessible sur: **http://localhost:5173**

‚è±Ô∏è Dur√©e: Instantan√©

---

## üî¨ OPTION 2: Test Complet avec Database Locale (45 minutes)

### Pr√©requis Suppl√©mentaires
- Docker Desktop install√©
- Supabase CLI install√©

### √âtapes

#### 1. Installer Supabase CLI
```bash
# macOS
brew install supabase/tap/supabase

# Windows (via Scoop)
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase

# Linux
brew install supabase/tap/supabase
```

#### 2. Initialiser Supabase Local
```bash
cd timepulse
supabase init
```

#### 3. D√©marrer Supabase Local
```bash
supabase start
```

Cette commande va:
- T√©l√©charger les images Docker
- D√©marrer PostgreSQL local
- D√©marrer Studio (interface web)
- D√©marrer Edge Functions runtime

‚è±Ô∏è Dur√©e: ~5 minutes (premi√®re fois)

Vous recevrez des URLs:
```
API URL: http://localhost:54321
Studio URL: http://localhost:54323
Anon key: eyJhbGc...
```

#### 4. Appliquer les Migrations Localement
```bash
# Copier toutes les migrations depuis le projet
cp supabase/migrations/*.sql supabase/migrations/

# Appliquer
supabase db reset
```

#### 5. Configurer .env pour Local
```env
VITE_SUPABASE_URL=http://localhost:54321
VITE_SUPABASE_ANON_KEY=eyJhbGc... (copier depuis output supabase start)
```

#### 6. Lancer l'App
```bash
npm run dev
```

---

## ‚úÖ CHECKLIST DE TEST

### üè† Homepage
- [ ] La page d'accueil charge correctement
- [ ] Le hero s'affiche avec animations
- [ ] Les √©v√©nements √† venir s'affichent
- [ ] Les features sont visibles
- [ ] Le footer contient les bonnes infos

### üë§ Authentification Organisateur
- [ ] Cr√©er un compte organisateur
- [ ] Se connecter
- [ ] Acc√©der au dashboard
- [ ] Se d√©connecter

### üìÖ Gestion √âv√©nements
- [ ] Cr√©er un nouvel √©v√©nement
- [ ] Upload image √©v√©nement
- [ ] Ajouter une course
- [ ] Configurer les prix
- [ ] Publier l'√©v√©nement

### üí≥ Inscriptions
- [ ] Formulaire inscription public s'affiche
- [ ] Remplir tous les champs
- [ ] Valider le formulaire
- [ ] (Si Stripe configur√©) Paiement test
- [ ] Recevoir confirmation

### üìä Module R√©sultats
- [ ] Cr√©er fichier CSV test:
```csv
Dossard,Nom,Pr√©nom,Sexe,Cat√©gorie,Temps
1,MARTIN,Jean,M,SEM,01:25:30
2,DUBOIS,Sophie,F,SEF,01:28:15
3,DURAND,Pierre,M,V1M,01:32:45
```
- [ ] Uploader via ResultsImporter
- [ ] V√©rifier preview
- [ ] Import r√©ussi
- [ ] Consulter page r√©sultats publique
- [ ] Tester recherche/filtres
- [ ] Exporter CSV

### üìà Statistiques
- [ ] Acc√©der dashboard stats
- [ ] V√©rifier KPIs (inscrits, revenus)
- [ ] Graphique par jour s'affiche
- [ ] R√©partition par course
- [ ] R√©partition par genre
- [ ] Filtrer par p√©riode (7j/30j)

### üì• Exports Excel
Test dans la console navigateur:
```javascript
// Ouvrir console (F12)
import { exportToCSV } from './src/lib/excel-export.js';

const testEntries = [{
  bibNumber: 1,
  firstName: 'Jean',
  lastName: 'Martin',
  gender: 'M',
  birthDate: '1990-01-15',
  nationality: 'FRA',
  email: 'jean@example.com',
  phone: '0612345678',
  category: 'SEM',
  raceName: 'Marathon',
  price: 45.00,
  status: 'confirmed',
  registrationDate: new Date().toISOString()
}];

exportToCSV(testEntries, 'test.csv');
```
- [ ] Export CSV standard
- [ ] Export Elogica
- [ ] Export Emails
- [ ] Ouvrir dans Excel, v√©rifier encodage

### üèÉ Int√©gration FFA (Mode Mock)
```javascript
// Console navigateur
import { verifyFFALicense } from './src/lib/ffa-api.js';

const result = await verifyFFALicense('1234567890');
console.log(result);
// Devrait retourner donn√©es mock avec valid: true
```
- [ ] Mode mock fonctionne
- [ ] Donn√©es coh√©rentes retourn√©es

### üèä Int√©gration FFTri (Mode Mock)
```javascript
import { verifyFFTriLicense } from './src/lib/fftri-api.js';

const result = await verifyFFTriLicense('T123456');
console.log(result);
// Devrait retourner niveau FIS, club, etc.
```
- [ ] Mode mock fonctionne
- [ ] Niveau FIS valide
- [ ] V√©rification suspension

### üì± SMS (Mode Mock)
Test via Supabase Dashboard > SQL Editor:
```sql
-- Cr√©er un log SMS test
INSERT INTO sms_logs (phone_number, message, status)
VALUES ('+33612345678', 'Test SMS Timepulse', 'sent');

-- V√©rifier
SELECT * FROM sms_logs;
```
- [ ] Log SMS cr√©√©
- [ ] Statuts corrects

### üöó Covoiturage
- [ ] Cr√©er offre covoiturage
- [ ] R√©server place
- [ ] Code gestion re√ßu par email
- [ ] Annuler r√©servation

### üéüÔ∏è √âchange Dossards
- [ ] Mettre dossard en vente
- [ ] Rechercher dossards disponibles
- [ ] Acheter un dossard
- [ ] V√©rifier transfert

---

## üêõ TESTS DE R√âGRESSION

### Performance
```bash
# Build production
npm run build

# V√©rifier taille
ls -lh dist/assets/

# Devrait √™tre ~200KB total
```

### TypeScript
```bash
# V√©rifier types
npm run typecheck

# Devrait afficher: "Found 0 errors"
```

### Linting
```bash
npm run lint
```

---

## üîç DEBUGGING

### Erreurs Courantes

#### 1. "Cannot find module @supabase/supabase-js"
```bash
npm install
```

#### 2. "Supabase URL not configured"
V√©rifier que `.env` contient:
```env
VITE_SUPABASE_URL=https://...
VITE_SUPABASE_ANON_KEY=eyJ...
```

Red√©marrer le serveur:
```bash
# Ctrl+C puis
npm run dev
```

#### 3. "Table does not exist"
Les migrations ne sont pas appliqu√©es.
Aller dans Supabase Dashboard > SQL Editor et appliquer toutes les migrations.

#### 4. "RLS policy violation"
- V√©rifier que vous √™tes bien authentifi√©
- Les policies RLS sont restrictives par d√©faut
- Certaines actions n√©cessitent un r√¥le admin/organisateur

#### 5. Build √©choue
```bash
# Nettoyer cache
rm -rf node_modules dist
npm install
npm run build
```

### Logs Utiles

**Logs Supabase**:
```bash
# Si Supabase local
supabase logs
```

**Logs PostgreSQL**:
Dans Supabase Dashboard > Logs

**Console Navigateur**:
- F12 > Console
- Voir les erreurs JavaScript
- Voir les appels r√©seau (Network tab)

---

## üìä DONN√âES DE TEST

### Cr√©er un Admin
```sql
-- Via Supabase Dashboard > SQL Editor
INSERT INTO admin_users (id, email, full_name, role)
VALUES (
  auth.uid(), -- Votre user ID apr√®s signup
  'admin@timepulse.fr',
  'Admin Timepulse',
  'super_admin'
);
```

### Cr√©er un Organisateur
```sql
-- 1. Cr√©er l'organisateur
INSERT INTO organizers (name, email, phone)
VALUES ('Test Chrono', 'test@chrono.fr', '0612345678')
RETURNING id;

-- 2. Lier √† votre user (copier l'id retourn√© ci-dessus)
INSERT INTO organizer_users (organizer_id, user_id, role)
VALUES ('id-copi√©-ici', auth.uid(), 'owner');
```

### Cr√©er un √âv√©nement Test
```sql
INSERT INTO events (
  name,
  description,
  location,
  start_date,
  organizer_id,
  status
)
VALUES (
  'Marathon Test',
  '√âv√©nement de test',
  'Paris, France',
  '2025-06-15',
  'organizer-id-ici',
  'published'
)
RETURNING id;
```

### Cr√©er une Course Test
```sql
INSERT INTO races (
  event_id,
  name,
  distance,
  elevation_gain,
  max_participants,
  start_time
)
VALUES (
  'event-id-ici',
  '10km',
  10,
  150,
  500,
  '2025-06-15 09:00:00'
);
```

---

## üé• SC√âNARIOS DE TEST

### Sc√©nario 1: Parcours Organisateur Complet
1. S'inscrire comme organisateur
2. Cr√©er un √©v√©nement
3. Ajouter 2 courses
4. Configurer tarifs
5. Publier √©v√©nement
6. Consulter page publique
7. Importer r√©sultats (CSV test)
8. Consulter stats

**Temps estim√©**: 15 minutes

### Sc√©nario 2: Parcours Participant
1. Consulter √©v√©nements disponibles
2. Cliquer sur un √©v√©nement
3. Choisir une course
4. Remplir formulaire inscription
5. (Mock) Payer
6. Recevoir confirmation
7. Consulter ses inscriptions

**Temps estim√©**: 10 minutes

### Sc√©nario 3: Import R√©sultats
1. Cr√©er un fichier CSV avec 50 r√©sultats
2. Se connecter comme organisateur
3. Aller dans l'√©v√©nement
4. Import r√©sultats
5. V√©rifier preview
6. Confirmer import
7. V√©rifier page r√©sultats publique
8. Tester filtres et recherche
9. Exporter r√©sultats

**Temps estim√©**: 15 minutes

---

## üì± TESTS MOBILE

### iOS Safari
- Ouvrir http://localhost:5173 dans Safari iOS
- Tester toutes les fonctionnalit√©s
- V√©rifier responsive design
- Tester formulaires
- V√©rifier upload images

### Android Chrome
- Ouvrir http://localhost:5173 dans Chrome Android
- M√™mes tests qu'iOS
- V√©rifier comportement back button
- Tester notifications (si activ√©es)

### Outils de Test
```bash
# Simuler mobile dans navigateur
# Ouvrir DevTools (F12)
# Toggle Device Toolbar (Ctrl+Shift+M)
# Choisir iPhone 14 Pro, Pixel 7, etc.
```

---

## ‚ö° TESTS DE PERFORMANCE

### Lighthouse
```bash
# Installer Lighthouse CLI
npm install -g lighthouse

# Build production
npm run build

# Servir en local
npx serve -s dist -p 3000

# Run Lighthouse
lighthouse http://localhost:3000 --view
```

**Cibles**:
- Performance: >90
- Accessibility: >90
- Best Practices: >90
- SEO: >90

### Tests de Charge
```bash
# Installer Artillery
npm install -g artillery

# Cr√©er test.yml
cat > test.yml << EOF
config:
  target: 'http://localhost:5173'
  phases:
    - duration: 60
      arrivalRate: 10
scenarios:
  - flow:
    - get:
        url: "/"
    - get:
        url: "/events"
EOF

# Ex√©cuter
artillery run test.yml
```

---

## üéØ CRIT√àRES DE VALIDATION

### Must-Have (Bloquants)
- [ ] Homepage charge en <2s
- [ ] Authentification fonctionne
- [ ] Cr√©ation √©v√©nement fonctionne
- [ ] Inscription publique fonctionne
- [ ] Import r√©sultats fonctionne
- [ ] Stats s'affichent correctement
- [ ] Export Excel fonctionne
- [ ] Aucune erreur console critique
- [ ] Build production r√©ussi
- [ ] TypeCheck passe (0 errors)

### Should-Have (Importants)
- [ ] Paiement Stripe (mode test)
- [ ] Emails Oximailing
- [ ] SMS Oxisms (mock)
- [ ] Covoiturage
- [ ] √âchange dossards
- [ ] Mobile responsive
- [ ] Performance >80 Lighthouse

### Nice-to-Have (Bonus)
- [ ] API FFA r√©elle
- [ ] API FFTri r√©elle
- [ ] Certificats PDF
- [ ] Newsletter
- [ ] Tests unitaires
- [ ] Tests E2E

---

## üöÄ APR√àS LES TESTS

### Si Tout Fonctionne ‚úÖ
1. Commiter les derniers changements
2. Suivre QUICK-START.md pour d√©ploiement Vercel
3. Appliquer migrations sur Supabase production
4. Configurer les vraies cl√©s API
5. Tester en production
6. Annoncer le lancement!

### Si Bugs Trouv√©s üêõ
1. Noter tous les bugs dans un fichier BUGS.md
2. Prioriser (bloquant/important/mineur)
3. Corriger les bloquants
4. Re-tester
5. It√©rer jusqu'√† stabilit√©

---

## üìû SUPPORT

Besoin d'aide pendant les tests?
- üìß dev@timepulse.fr
- üìö Lire LOCAL-DEVELOPMENT.md
- üêõ Cr√©er une issue GitHub
- üí¨ Demander √† Bolt (moi!)

---

**Bon courage pour les tests!** üß™üöÄ
